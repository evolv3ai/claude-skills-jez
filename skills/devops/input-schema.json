{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "DevOps Inventory Management Parameters",
  "description": "Parameters for infrastructure inventory operations. Required fields depend on the operation type (provision, add server, update status, query).",
  "type": "object",
  "required": [],
  "properties": {
    "operation": {
      "type": "string",
      "description": "Type of operation to perform",
      "enum": ["provision", "add_server", "update_status", "query", "connect"]
    },
    "provider": {
      "type": "string",
      "description": "Cloud provider for provisioning (required for 'provision' operation)",
      "enum": ["oci", "hetzner", "digitalocean", "vultr", "linode", "contabo", "local_network"]
    },
    "server_id": {
      "type": "string",
      "description": "Unique server ID for inventory (e.g., WEB01, COOLIFY01)",
      "pattern": "^[A-Z0-9_]+$"
    },
    "server_name": {
      "type": "string",
      "description": "Human-friendly server name"
    },
    "server_host": {
      "type": "string",
      "description": "Server IP address or hostname"
    },
    "server_user": {
      "type": "string",
      "description": "SSH username for server access",
      "default": "ubuntu"
    },
    "ssh_key_path": {
      "type": "string",
      "description": "Path to SSH private key",
      "default": "~/.ssh/id_rsa"
    },
    "ssh_public_key_path": {
      "type": "string",
      "description": "Path to SSH public key (for provisioning)",
      "default": "~/.ssh/id_rsa.pub"
    },
    "server_role": {
      "type": "string",
      "description": "Server role/purpose",
      "enum": ["web", "db", "dev", "desktop", "coolify", "kasm", "other"]
    },
    "server_env": {
      "type": "string",
      "description": "Environment classification",
      "enum": ["prod", "staging", "dev", "test", "personal", "lab"]
    },
    "server_kind": {
      "type": "string",
      "description": "Server type",
      "enum": ["vm", "physical", "local_pc", "container_host", "other"]
    },
    "server_status": {
      "type": "string",
      "description": "Server status (for update operations)",
      "enum": ["active", "stopped", "retired", "unreachable"]
    },
    "region": {
      "type": "string",
      "description": "Provider region/zone (provider-specific)"
    },
    "instance_shape": {
      "type": "string",
      "description": "Instance size/shape (provider-specific)"
    },
    "os_image": {
      "type": "string",
      "description": "OS image to use (provider-specific)"
    }
  },
  "allOf": [
    {
      "if": {
        "properties": {
          "operation": { "const": "provision" }
        },
        "required": ["operation"]
      },
      "then": {
        "required": ["provider", "server_id", "server_name", "server_role", "server_env"]
      }
    },
    {
      "if": {
        "properties": {
          "operation": { "const": "add_server" }
        },
        "required": ["operation"]
      },
      "then": {
        "required": ["server_id", "server_name", "server_host", "server_user", "server_role"]
      }
    },
    {
      "if": {
        "properties": {
          "operation": { "const": "update_status" }
        },
        "required": ["operation"]
      },
      "then": {
        "required": ["server_id", "server_status"]
      }
    },
    {
      "if": {
        "properties": {
          "operation": { "const": "connect" }
        },
        "required": ["operation"]
      },
      "then": {
        "required": ["server_id"]
      }
    }
  ]
}
